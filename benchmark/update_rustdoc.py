#!/usr/bin/env python3

from base64 import b64encode


def update_rustdoc():
    with open("doc/latency-rustdoc.md", "w+") as fp:
        fp.write(
            template(
                fast_dark=base64_encode("benchmark/measurements_fast_dark.svg"),
                fast_light=base64_encode("benchmark/measurements_fast_light.svg"),
                slow_dark=base64_encode("benchmark/measurements_slow_dark.svg"),
                slow_light=base64_encode("benchmark/measurements_slow_light.svg"),
            )
        )


def base64_encode(file_path):
    with open(file_path, "rb") as fp:
        return b64encode(fp.read()).decode("utf-8")


def template(*, fast_dark, fast_light, slow_dark, slow_light):
    return f"""# Latency Measurements
<!-- This file is auto-generated by benchmark/update_rustdoc.py -->

Measurements generated using `examples/benchmark`:
```shell
cargo run --release -p benchmark '<TERM_NAME>'
```

## Fast Terminals

<picture>
    <source media="(prefers-color-scheme: dark)" srcset="data:image/svg+xml;base64,{fast_dark}">
    <img src="data:image/svg+xml;base64,{fast_light}">
</picture>

## Slow Terminals

<picture>
    <source media="(prefers-color-scheme: dark)" srcset="data:image/svg+xml;base64,{slow_dark}">
    <img src="data:image/svg+xml;base64,{slow_light}">
</picture>

**ℹ️ Note:**
The macOS terminals were not tested on the same machine as the Linux terminals.
"""


if __name__ == "__main__":
    update_rustdoc()
